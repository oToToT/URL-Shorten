"use strict";function asyncGeneratorStep(e,t,n,r,o,c,s){try{var a=e[c](s),u=a.value}catch(e){return void n(e)}a.done?t(u):Promise.resolve(u).then(r,o)}function _asyncToGenerator(a){return function(){var e=this,s=arguments;return new Promise(function(t,n){var r=a.apply(e,s);function o(e){asyncGeneratorStep(r,t,n,o,c,"next",e)}function c(e){asyncGeneratorStep(r,t,n,o,c,"throw",e)}o(void 0)})}}var config={API_URL:"https://asia-northeast1-url-shorten-dve-tw.cloudfunctions.net/url-shorten",BASE_URL:"https://dve.tw/"};!function(){function e(){document.getElementById("shorten").addEventListener("click",_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,n,r,o,c,s,a,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((t=document.getElementById("shorten")).innerText="生成中",t.setAttribute("disabled","true"),t.classList.replace("btn-outline-success","btn-info"),n=function(e){try{return Boolean(new URL(e))}catch(e){return!1}},r=document.getElementById("url").value,n(r)){e.next=15;break}return t.classList.replace("btn-info","btn-outline-success"),t.innerText="縮個！",t.removeAttribute("disabled"),e.next=12,swal({title:"格式錯誤",text:"很抱歉，我們目前僅能縮短一個完整的網址",icon:"error",buttons:[{text:"Bug回報",value:!0},{text:"OK",value:!1}]});case 12:return e.sent,e.abrupt("return");case 15:return e.prev=15,e.next=18,fetch(config.API_URL,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/x-www-form-urlencoded;charset=utf-8"},body:"url="+encodeURIComponent(r)}).then(function(e){return e.json()});case 18:if(!(o=e.sent).error){e.next=26;break}t.classList.replace("btn-info","btn-outline-success"),t.innerText="縮個！",t.removeAttribute("disabled"),swal("錯誤",o.error,"error"),e.next=43;break;case 26:if(o.success)return c=new ClipboardJS("#copy"),(s=document.getElementById("shorten_url")).value=config.BASE_URL+o.entry,(a=document.getElementById("original_url")).href=r,a.innerText=r,document.getElementById("qr_code").src="https://chart.googleapis.com/chart?chs=200x200&cht=qr&chld=L|1&chl=".concat(encodeURIComponent(s.value)),u=document.getElementById("modal"),t.classList.replace("btn-info","btn-outline-success"),t.innerText="縮個！",t.removeAttribute("disabled"),e.next=41,swal({title:"成功建立短網址",content:u,closeOnClickOutside:!1});e.next=43;break;case 41:r="",c.destroy();case 43:e.next=54;break;case 45:return e.prev=45,e.t0=e.catch(15),t.classList.replace("btn-info","btn-outline-success"),t.innerText="縮個！",t.removeAttribute("disabled"),e.next=52,swal({title:"未知錯誤",text:"無法建立短網址，請確認網路連線是否正常",icon:"error",buttons:[{text:"Bug回報",value:!0},{text:"OK",value:!1}]});case 52:e.sent;case 54:case"end":return e.stop()}},e,null,[[15,45]])})))}"loading"!=document.readyState?e():document.addEventListener("DOMContentLoaded",e)}();